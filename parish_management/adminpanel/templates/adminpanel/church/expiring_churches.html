{% extends "adminpanel/base.html" %}
{% block content %}

<div class="row">
  <div class="col-12 col-xl-10 mx-auto">

    <div class="card card-outline card-warning">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title mb-0">
          Expiring Subscriptions
        </h3>

        <a href="{% url 'adminpanel:dashboard' %}"
           class="btn btn-sm btn-outline-secondary">
          ‚Üê Back to Dashboard
        </a>
      </div>

      <div class="card-body p-0">

        {% if churches %}

          <table class="table table-bordered table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th>Church</th>
                <th>Package</th>
                <th>City</th>
                <th>Expires On</th>
                <th>Days Left</th>
                <th></th>
              </tr>
            </thead>

            <tbody>
              {% for c in churches %}
                <tr>
                  <td>
                    <strong>{{ c.name }}</strong><br>
                    <small class="text-muted">{{ c.email }}</small>
                  </td>

                  <td>
                    {{ c.churchsubscription.package.name }}
                  </td>

                  <td>{{ c.city }}</td>

                  <td>
                    {{ c.churchsubscription.end_date }}
                  </td>

                  <td>
                    {% if c.churchsubscription.expires_in_days <= 3 %}
                      <span class="badge bg-danger">
                        {{ c.churchsubscription.expires_in_days }} days
                      </span>
                    {% else %}
                      <span class="badge bg-warning text-dark">
                        {{ c.churchsubscription.expires_in_days }} days
                      </span>
                    {% endif %}
                  </td>

                  <td class="text-end">
                    <a href="{% url 'adminpanel:church_detail' c.id %}"
                       class="btn btn-sm btn-outline-primary">
                      View
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

        {% else %}
          <div class="p-4 text-center text-muted">
            <h5 class="mb-2">üéâ No Expiring Subscriptions</h5>
            <p class="mb-0">
              All active subscriptions are valid for more than 7 days.
            </p>
          </div>
        {% endif %}

      </div>
    </div>

  </div>
</div>

{% endblock %}
